<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Saved Graphs</title>
    <link rel="icon" type="image/x-icon" href="delete.png">
    
    <link rel="stylesheet" href="app-pages.css" />
    <link rel="stylesheet" href="settings.css" />
    <link rel="icon" type="image/ico" href="/regression-expert.ico" />
  </head>
  <body>
    <div class="settings-page">
      <a href="/home" class="small-logo">
        <img src="Images/RegressionExpert-small-logo.png" alt="RegressionExpert"
      /></a>

      <div class="popup" id="popup">
        <h2>Are you sure you want to log out?</h2>
      
        <button type="button" onclick="closePopup()" class="no-btn">No</button>
        <button type="button" onclick="logout()" class="yes-btn">Yes</button>
      </div>
      <section class="settings-panel">
      <h1 class='main-title'>Load a previously saved graph</h1>
      <hr />
      <form id='user' action='/saved' method='post'>
        <input hidden id='username' name='username'>
        <input hidden id='isOK' name='isOK' value="<%= ok %>">
      </form>
      <div class="graph-list">
        <% for(let i = 0; i < btns.length; i++){ %>
          <div class="graph-row">
            <div class="graph-name-wrap">
              <p id="1<%= btns[i].points %>" class="graph-name"><%= btns[i].name %></p>
              <p hidden id='2<%= btns[i].points %>' class="hide"><%= btns[i].regressions %></p>
            </div>
            <div class="graph-actions">
              <button id="<%= btns[i].points %>" class="setting-option-btns graph-btn" onclick="getGraph(this.id)">Edit<img src="edit-icon.png"></button>
              <button id="3<%= btns[i].points %>" class="setting-option-btns graph-btn delete-btn" onclick="delGraph(this.id)">Delete<img src="delete-icon.png" height='41' width='41'></button>
            </div>
          </div>
          <hr>
        <% }%>
      </div>
      <div class="settings-actions">
        <button class="setting-option-btns" onclick="window.location.href='home';">Home Page</button>
      </div>
      </section>
      <div hidden>
        <form id='del' action='/delete' method='post'>
          <input id='deluser' name='deluser'>
          <input id='delpts' name='delpts'>
          <input id='gname' name='gname'>
        </form>
      </div>
    </div>
    <script>

      let popup = document.getElementById('popup')

      function openPopup(){
        popup.classList.add('open-popup')
      }

      function closePopup(){
        popup.classList.remove('open-popup')
      }

      function logout(){
        window.location.href = "index";
        localStorage.removeItem("username");
      }

      function getGraph(id){
        localStorage.setItem("points", id);
        localStorage.setItem("graph-name", document.getElementById('1'+id).innerText);
        localStorage.setItem("lines", document.getElementById('2'+id).innerText);
        window.location.href = "graph-editor";
      }

      function delGraph(id){
        id = id.substring(1);
        document.getElementById("delpts").value = id;
        const user = localStorage.getItem("username");
        document.getElementById("deluser").value = user;
        document.getElementById('gname').value = document.getElementById('1'+id).innerText;
        if(!confirm("Are you sure you want to delete '"+document.getElementById('gname').value+"'? This cannot be undone!")) {
          return;
        }
        let form = document.getElementById('del');
        form.submit();
      }

      const user = localStorage.getItem("username");
      let username = document.getElementById("username");
      username.value = user;
      let form = document.getElementById('user');
      form.submit();

      if(user == null){
        alert("You are not logged in. Please log in first. ");
        window.location.href = "index";
      }


    </script>
  </body>
</html>
